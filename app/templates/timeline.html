{% extends "base.html" %}

{% block body %}

<div class="form">
    <p>Make a Post</p>
    <form id="timeline_form" onsubmit="postFormData(event)">
        <input type="text" name="name" id="name" placeholder="Name">
        <br><br>
        <input type="text" name="email" id="email" placeholder="Email">
        <br><br>
        <textarea type="text" name="content" id="content" placeholder="Post something on my timeline!"></textarea>
        <br><br>
        <input type="submit" value="Post">
    </form>
</div>


<div class="timeline">
    <br>
    <p style="text-align:left">Posts</p>
{% for post in timeline['timeline_posts'] %}
    {% if post['name'] != '' %}
    <div class="timeline_post">
        <p style="text-align:left">{{ post['created_at'] }}</p>
        <p style="text-align:left">{{ post['name'] }} ({{ post['email'] }}):</p>
        <br>
        <p>{{ post['content'] }}</p>
    </div>
    {% endif %}
    {% endfor %}
</div>


<script>
    // must be asynchronous for fetch to work.
    async function postFormData(e) {
        // prevents going to the API return page
        e.preventDefault();

        // get form data
        const form = document.getElementById('timeline_form');
        const formData = new FormData(form);

        // try POST request
        try {
            await fetch('/api/timeline_post', {
                method: 'POST',
                body: formData
            })

        } catch (err) {
            console.log('An error occured');
        } finally {
            // reload
            form.reset()
            location.reload()
        }
    }

    // document.getElementById('timeline_form').addEventListener('submit', async (e) => {
    //     e.preventDefault();
    //     const formData= new FormData(e.target)
    //     await fetch('/api/timeline_post', {
    //         method: 'POST',
    //         body: formData
    //     });
    //     location.reload()
    // });

</script>
{% endblock %}